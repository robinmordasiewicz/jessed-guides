
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Example #3 - module creation and usage &#8212; Day 0 Beginners Guide to Terraform 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example #4 - module usage with ternary conditional and ‘count’ meta-argument" href="example_4.html" />
    <link rel="prev" title="Example #2 - object output" href="example_2.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="example-3-module-creation-and-usage">
<h1>Example #3 - module creation and usage<a class="headerlink" href="#example-3-module-creation-and-usage" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://developer.hashicorp.com/terraform/tutorials/modules/module">Official Documentation</a></p>
<p><strong>NOTE</strong>: In order to execute this example you must have access to the Azure CLI and it must be authenticated to work with Azure.</p>
<p><strong>NOTE</strong>: This example will create two Azure Resource-Groups called ‘my_lab-1-rg’ and ‘my_lab-2-rg’.</p>
<p>The following example illustrates the Terraform code:</p>
<ol class="arabic simple">
<li><p>Usage of the ‘vars.tf’, ‘outputs.tf’, and ‘main.tf’ as separate files</p></li>
<li><p>Usage of the Azure provider</p></li>
<li><p>Creation and usage of a module</p></li>
</ol>
<p>Typically Terraform Runs use separate files for input variables, configuration blocks, and output blocks. Modules are defined in a sub-directories beneath the main Terraform directory. The typical directory structure, as well as the separate files, are illustrated here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span>
<span class="o">+--</span> <span class="n">main</span><span class="o">.</span><span class="n">tf</span>
<span class="o">+--</span> <span class="nb">vars</span><span class="o">.</span><span class="n">tf</span>
<span class="o">+--</span> <span class="n">outputs</span><span class="o">.</span><span class="n">tf</span>
<span class="o">+--</span> <span class="n">modules</span>
<span class="o">|</span>   <span class="o">+--</span> <span class="n">resource_group</span>
<span class="o">|</span>      <span class="o">+--</span> <span class="n">main</span><span class="o">.</span><span class="n">tf</span>
<span class="o">|</span>      <span class="o">+--</span> <span class="n">variables</span><span class="o">.</span><span class="n">tf</span>
<span class="o">|</span>      <span class="o">+-</span> <span class="o">-</span><span class="n">outputs</span><span class="o">.</span><span class="n">tf</span>
</pre></div>
</div>
<p>In this example we are creating a single module called <em>resource_group</em>. We are calling the <em>resource_group</em> module to create an Azure resource-group. Creating a resource-group in Azure reuqires a couple variables, specifically, a name and a location. These variables are passed to the module when it is called using variable assignments specified in <em>main.tf</em>. Those variables are also defined in the <em>variables.tf</em> file located within the module sub-directory.</p>
<p>The ./modules/resource_group/variables.tf file defines the input variables required by the module. All of the variables defined in the modules <em>variables.tf</em> file must be provided when the module is called from main.tf. If a variable is defined in the ./modules/<em>&lt;module&gt;</em>/variables.tf file and it is <em>not</em> provided when the module is called you will receive an error when running terraform [plan|apply].</p>
<p><strong>Note</strong>: Additional variables can be provided to the module when it is called even without being defined in the variables.tf file; however, any additional variables will not be available for use. They simply don’t cause a syntax error.</p>
<section id="vars-tf">
<h2>./vars.tf<a class="headerlink" href="#vars-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">variable</span> <span class="s2">&quot;prefix&quot;</span>     <span class="p">{</span> <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;my_lab&quot;</span> <span class="p">}</span>
<span class="n">variable</span> <span class="s2">&quot;location&quot;</span>   <span class="p">{</span> <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;westus2&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="main-tf">
<h2>./main.tf<a class="headerlink" href="#main-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">terraform</span> <span class="p">{</span>
  <span class="n">required_providers</span> <span class="p">{</span>
    <span class="n">azurerm</span> <span class="o">=</span> <span class="p">{</span> <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;~&gt; 3.27.0&quot;</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">provider</span> <span class="s2">&quot;azurerm&quot;</span> <span class="p">{</span>
  <span class="n">features</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="n">module</span> <span class="s2">&quot;rg1&quot;</span> <span class="p">{</span>
  <span class="n">source</span>                <span class="o">=</span> <span class="s2">&quot;./modules/resource_group&quot;</span>
  <span class="n">prefix</span>                <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">prefix</span>
  <span class="n">location</span>              <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">location</span>
<span class="p">}</span>
<span class="n">module</span> <span class="s2">&quot;rg2&quot;</span> <span class="p">{</span>
  <span class="n">source</span>                <span class="o">=</span> <span class="s2">&quot;./modules/resource_group&quot;</span>
  <span class="n">prefix</span>                <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">prefix</span>
  <span class="n">location</span>              <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">location</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="outputs-tf">
<h2>./outputs.tf<a class="headerlink" href="#outputs-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="s2">&quot;rg1&quot;</span> <span class="p">{</span>
  <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Resource group details&quot;</span>
  <span class="n">value</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">rg_name</span>     <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rg1</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">name</span>
    <span class="n">rg_location</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rg1</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">location</span>
    <span class="n">rg_id</span>       <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rg1</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">id</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">output</span> <span class="s2">&quot;rg2&quot;</span> <span class="p">{</span>
  <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Resource group details&quot;</span>
  <span class="n">value</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">rg_name</span>     <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rg2</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">name</span>
    <span class="n">rg_location</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rg2</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">location</span>
    <span class="n">rg_id</span>       <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rg2</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">id</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="modules-resource-group-variables-tf">
<h2>./modules/resource_group/variables.tf<a class="headerlink" href="#modules-resource-group-variables-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">variable</span> <span class="n">prefix</span>     <span class="p">{}</span>
<span class="n">variable</span> <span class="n">location</span>   <span class="p">{}</span>
</pre></div>
</div>
<p>The module variables.tf file defines the variables required by the module. These variables <em>must</em> be provided when the module is called. If variables are defined in the module variables.tf file but not provided when the module is called an error will be reported when you run terraform [plan|apply].</p>
</section>
<section id="modules-resource-group-main-tf">
<h2>./modules/resource_group/main.tf<a class="headerlink" href="#modules-resource-group-main-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s2">&quot;azurerm_resource_group&quot;</span> <span class="s2">&quot;rg&quot;</span> <span class="p">{</span>
  <span class="n">name</span>      <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">prefix</span>
  <span class="n">location</span>  <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">location</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The module main.tf file defines the actions that will be taken by the module. The syntax is identical to the syntax defined in the primary main.tf; however, the only variables available are those defined in the module variables.tf file.</p>
</section>
<section id="modules-resource-group-outputs-tf">
<h2>./modules/resource_group/outputs.tf<a class="headerlink" href="#modules-resource-group-outputs-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="s2">&quot;out&quot;</span> <span class="p">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">azurerm_resource_group</span><span class="o">.</span><span class="n">rg</span> <span class="p">}</span>
</pre></div>
</div>
<p>The module outputs.tf file sends the outputs back to the main terraform execution. These outputs can then be used as input variables to other configuration blocks, including other modules. They can also be used in output blocks defined in the main directory to print the values after the Terraform Run completes. One very common example of this is printing the IP addresses of virtual-machines instantiated by the Terraform run.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Day 0 Beginners Guide to Terraform</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Providers.html">Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Registry.html">Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configurations.html">Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="Runs.html">Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="Variables.html">Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="Initialization.html">Initialization: <cite>terraform init</cite></a></li>
<li class="toctree-l1"><a class="reference internal" href="Execution.html">Execution: Plan, Apply, Destroy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tips_and_Tricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_1.html">Example #1 - Simple variables and output</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_2.html">Example #2 - object output</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example #3 - module creation and usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#vars-tf">./vars.tf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main-tf">./main.tf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#outputs-tf">./outputs.tf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modules-resource-group-variables-tf">./modules/resource_group/variables.tf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modules-resource-group-main-tf">./modules/resource_group/main.tf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modules-resource-group-outputs-tf">./modules/resource_group/outputs.tf</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_4.html">Example #4 - module usage with ternary conditional and ‘count’ meta-argument</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="example_2.html" title="previous chapter">Example #2 - object output</a></li>
      <li>Next: <a href="example_4.html" title="next chapter">Example #4 - module usage with ternary conditional and ‘count’ meta-argument</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Jesse Driskill.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/example_3.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>