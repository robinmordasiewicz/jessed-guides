
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Example #4 - module usage with ternary conditional and ‘count’ meta-argument &#8212; Day 0 Beginners Guide to Terraform 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Example #3 - module creation and usage" href="example_3.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="example-4-module-usage-with-ternary-conditional-and-count-meta-argument">
<h1>Example #4 - module usage with ternary conditional and ‘count’ meta-argument<a class="headerlink" href="#example-4-module-usage-with-ternary-conditional-and-count-meta-argument" title="Permalink to this heading">¶</a></h1>
<p><strong>NOTE</strong>: In order to execute this example you must have access to the Azure CLI and it must be authenticated to work with Azure.</p>
<p><strong>NOTE</strong>: This example will create three Azure Resource-Groups called ‘my_lab-1-rg’, ‘my_lab-2-rg’, and so on.</p>
<p>The following example illustrates the Terraform code:
1. Usage of the ‘vars.tf’, ‘outputs.tf’, and ‘main.tf’ as separate files
2. Usage of the Azure provider
3. Creation and usage of a module</p>
<p>Typically Terraform Runs use separate files for input variables, configuration blocks, and output blocks. Modules are defined in a sub-directories beneath the main Terraform directory. That directory structure, as well as the separate files, are illustrated here:</p>
<p>The files and directory structure typically follow this pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span>
<span class="o">|</span> <span class="n">main</span><span class="o">.</span><span class="n">tf</span>
<span class="o">|</span> <span class="nb">vars</span><span class="o">.</span><span class="n">tf</span>
<span class="o">|</span> <span class="n">outputs</span><span class="o">.</span><span class="n">tf</span>
<span class="o">|--</span><span class="n">modules</span>
<span class="o">|</span>
<span class="o">|</span>  <span class="o">|--</span><span class="n">resource_group</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">main</span><span class="o">.</span><span class="n">tf</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">variables</span><span class="o">.</span><span class="n">tf</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">outputs</span><span class="o">.</span><span class="n">tf</span>
</pre></div>
</div>
<p>In this example we are using the <em>resource_group</em> module to create an arbitrary number of resource-groups using the <a class="reference external" href="https://developer.hashicorp.com/terraform/language/meta-arguments/count">count</a> meta-argument. The <em>instances</em> variable controls the number of resource-groups created; however, the ‘single’ variable controls whether the ‘instances’ variable is actually used. If the ‘single’ variable is set to ‘true’, then the number of resource-groups crated is only one.</p>
<p>Checking the value of the ‘single’ variable is done by the <a class="reference external" href="https://developer.hashicorp.com/terraform/language/expressions/conditionals">ternary conditional</a>. The ternary conditional checks the value of a variable. If the condition is true, the first option following the ‘?’ is assigned to the variable. If the condition is false then the option following the ‘:’ is assigned. The basic syntax is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>variable = condition ? value_1 : value_2
</pre></div>
</div>
<p>The condition can be a simple comparison, as is shown in the example below, or it can be a compound comparison like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>variable = condition_1 &amp;&amp; condition_2 ? value_1 : value_2
</pre></div>
</div>
<p>Notice that ‘count’ is <em>not</em> defined in the module variables.tf file. This is because ‘count’ is a meta-argument that applies to the module and is not provided to the module itself. Rather, it defines how many times the module is called. Also notice that the ‘prefix’ variable sent to the module is updated for each iteration using the ‘count.index+1’ syntax. This ensures that each resource-group has a unique name, but can be used in other ways.</p>
<section id="vars-tf">
<h2>vars.tf<a class="headerlink" href="#vars-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">variable</span> <span class="s2">&quot;prefix&quot;</span>     <span class="p">{</span> <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;my_lab&quot;</span> <span class="p">}</span>
<span class="n">variable</span> <span class="s2">&quot;location&quot;</span>   <span class="p">{</span> <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;westus2&quot;</span> <span class="p">}</span>
<span class="n">variable</span> <span class="s2">&quot;single&quot;</span>     <span class="p">{</span> <span class="n">default</span> <span class="o">=</span> <span class="n">false</span> <span class="p">}</span>
<span class="n">variable</span> <span class="s2">&quot;instances   { default = 3 }</span>
</pre></div>
</div>
</section>
<section id="main-tf">
<h2>main.tf<a class="headerlink" href="#main-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>terraform {
  required_providers {
    azurerm = { version = &quot;~&gt; 3.27.0&quot; }
  }
}

provider &quot;azurerm&quot; {
  features {}
}

module &quot;rg&quot; {
  source                = &quot;./modules/resource_group&quot;
  count                 = var.single == false ? var.instances : 1
  prefix                = format(&quot;%s-%d-rg&quot;, var.prefix, count.index+1)
  location              = var.location
}
</pre></div>
</div>
</section>
<section id="outputs-tf">
<h2>outputs.tf<a class="headerlink" href="#outputs-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="s2">&quot;rg&quot;</span> <span class="p">{</span>
  <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Resource group details&quot;</span>
  <span class="n">value</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">rg_name</span>     <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rg</span><span class="o">.*.</span><span class="n">out</span><span class="o">.</span><span class="n">name</span>
    <span class="n">rg_location</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rg</span><span class="o">.*.</span><span class="n">out</span><span class="o">.</span><span class="n">location</span>
    <span class="n">rg_id</span>       <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rg</span><span class="o">.*.</span><span class="n">out</span><span class="o">.</span><span class="n">id</span>
  <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="modules-resource-group-variables-tf">
<h2>modules/resource_group/variables.tf<a class="headerlink" href="#modules-resource-group-variables-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">variable</span> <span class="n">prefix</span>     <span class="p">{}</span>
<span class="n">variable</span> <span class="n">location</span>   <span class="p">{}</span>
</pre></div>
</div>
</section>
<section id="modules-resource-group-main-tf">
<h2>modules/resource_group/main.tf<a class="headerlink" href="#modules-resource-group-main-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s2">&quot;azurerm_resource_group&quot;</span> <span class="s2">&quot;rg&quot;</span> <span class="p">{</span>
  <span class="n">name</span>      <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">prefix</span>
  <span class="n">location</span>  <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">location</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="modules-resource-group-outputs-tf">
<h2>modules/resource_group/outputs.tf<a class="headerlink" href="#modules-resource-group-outputs-tf" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="s2">&quot;out&quot;</span> <span class="p">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">azurerm_resource_group</span><span class="o">.</span><span class="n">rg</span> <span class="p">}</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Day 0 Beginners Guide to Terraform</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Providers.html">Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Registry.html">Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configurations.html">Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="Runs.html">Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="Variables.html">Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="Initialization.html">Initialization: <cite>terraform init</cite></a></li>
<li class="toctree-l1"><a class="reference internal" href="Execution.html">Execution: Plan, Apply, Destroy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tips_and_Tricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_1.html">Example #1 - Simple variables and output</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_2.html">Example #2 - object output</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_3.html">Example #3 - module creation and usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example #4 - module usage with ternary conditional and ‘count’ meta-argument</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#vars-tf">vars.tf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main-tf">main.tf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#outputs-tf">outputs.tf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modules-resource-group-variables-tf">modules/resource_group/variables.tf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modules-resource-group-main-tf">modules/resource_group/main.tf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modules-resource-group-outputs-tf">modules/resource_group/outputs.tf</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="example_3.html" title="previous chapter">Example #3 - module creation and usage</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Jesse Driskill.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/example_4.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>